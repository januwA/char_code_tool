<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>字符串与code的相互转换</title>
  </head>
  <body>
    <section>
      <h1>char to code</h1>
      <div>
        <input type="text" id="s_10c_i" value="成都" />
        <button id="s_10c_btn">字符串 to 10进制</button>
        <input type="text" id="s_10c_o" />
      </div>
      <div>
        <input type="text" id="s_16c_i" value="成都" />
        <button id="s_16c_btn">字符串 to 16进制</button>
        <input type="text" id="s_16c_o" />
      </div>
    </section>
    <section>
      <h1>code to char</h1>
      <div>
        <input type="text" id="_10c_s_i" value="25104 37117" />
        <button id="_10c_s_btn">10进制 to 字符串</button>
        <input type="text" id="_10c_s_o" />
      </div>
      <div>
        <input type="text" id="_16c_s_i" value="6210 90fd" />
        <button id="_16c_s_btn">16进制 to 字符串</button>
        <input type="text" id="_16c_s_o" />
      </div>
    </section>
    <section>
      <h1>16进制转单浮点</h1>
      <div>
        <input type="text" id="_16c_sfp_i" value="43290000" />
        <button id="_16c_sfp_btn">16进制 to 单浮点</button>
        <input type="text" id="_16c_sfp_o" />
      </div>
    </section>
    <section>
      <h1>负数与无符号位的转换</h1>
      <div>
        <input type="text" id="_n_ub_i" value="-2000" />
        <button id="_n_ub_btn">负数 to 无符号位</button>
        <input type="text" id="_n_ub_o" />
      </div>
      <div>
        <input type="text" id="_ub_n_i" value="4294965296" />
        <button id="_ub_n_btn">无符号位 to 负数</button>
        <input type="text" id="_ub_n_o" />
      </div>
    </section>
    <script>
      const $ = (select) => document.querySelector(select);
      function code2char(inputString, hook) {
        return inputString
          .split(/\s+/)
          .filter((it) => !!it)
          .reduce((acc, it) => {
            acc += String.fromCharCode(parseInt(it, hook));
            return acc;
          }, "");
      }
      function char2code(inputString, hook) {
        return inputString.split("").reduce((acc, it) => {
          acc += it.codePointAt(0).toString(hook) + " ";
          return acc;
        }, "");
      }
      function hex2SingleFloatingPoint(hex) {
        // https://blog.csdn.net/qq_19286023/article/details/72651568
        const data_bit = parseInt(hex, 16).toString(2); //16进制转2进制
        const data_E = parseInt(data_bit.slice(0, 8), 2); //slice表示数组的截取，并转化为十进制数
        const data_M = data_bit.slice(8, 64);
        var data_M_10 = 0.0;
        for (var i = 0; i < data_M.length; i++) {
          data_M_10 = data_M_10 + data_M[i] * Math.pow(2, -1 * (i + 1));
        }
        return Math.pow(2, data_E - 127) * (1 + data_M_10);
      }

      function negative2unsignedBit(num) {
        return 2 ** 32 - Number(num);
      }
      function unsignedBit2negative(num) {
        return -(2 ** 32 - Number(num));
      }
    </script>
    <script>
      // char to 10
      const s_10c_i = $("#s_10c_i");
      const s_10c_o = $("#s_10c_o");
      const s_10c_btn = $("#s_10c_btn");
      s_10c_btn.addEventListener("click", () => {
        s_10c_o.value = char2code(s_10c_i.value, 10);
      });

      // char to 16
      const s_16c_i = $("#s_16c_i");
      const s_16c_o = $("#s_16c_o");
      const s_16c_btn = $("#s_16c_btn");
      s_16c_btn.addEventListener("click", () => {
        s_16c_o.value = char2code(s_16c_i.value, 16);
      });
    </script>
    <script>
      // 10 to char
      const _10c_s_i = $("#_10c_s_i");
      const _10c_s_o = $("#_10c_s_o");
      const _10c_s_btn = $("#_10c_s_btn");
      _10c_s_btn.addEventListener("click", () => {
        _10c_s_o.value = code2char(_10c_s_i.value, 10);
      });

      // 16 to char
      const _16c_s_i = $("#_16c_s_i");
      const _16c_s_o = $("#_16c_s_o");
      const _16c_s_btn = $("#_16c_s_btn");
      _16c_s_btn.addEventListener("click", () => {
        _16c_s_o.value = code2char(_16c_s_i.value, 16);
      });
    </script>
    <script>
      const _16c_sfp_i = $("#_16c_sfp_i");
      const _16c_sfp_o = $("#_16c_sfp_o");
      const _16c_sfp_btn = $("#_16c_sfp_btn");
      _16c_sfp_btn.addEventListener("click", () => {
        _16c_sfp_o.value = hex2SingleFloatingPoint(_16c_sfp_i.value, 16);
      });
    </script>
    <script>
      const _n_ub_i = $("#_n_ub_i");
      const _n_ub_o = $("#_n_ub_o");
      const _n_ub_btn = $("#_n_ub_btn");
      _n_ub_btn.addEventListener("click", () => {
        _n_ub_o.value = negative2unsignedBit(_n_ub_i.value);
      });
      const _ub_n_i = $("#_ub_n_i");
      const _ub_n_o = $("#_ub_n_o");
      const _ub_n_btn = $("#_ub_n_btn");
      _ub_n_btn.addEventListener("click", () => {
        _ub_n_o.value = unsignedBit2negative(_ub_n_i.value);
      });
    </script>
  </body>
</html>
